(function(){$(function(){var a="",d=false,c=false,g=$(document).width(),b=$(document).height(),e="",h="";if(!window.File&&!window.FileReader&&!window.FileList&&!window.Blob){alert("The File APIs are not fully supported in this browser.");return}if(!$("#pixiOverlay").length){$("body").append('<div id="pixiOverlay" style="height:'+$(document).height()+'px"></div>');setInterval(function(){$("#pixiOverlay").css("height",$(document).height()+"px")},1000);var a=$("#pixiOverlay")}if(localStorage.getItem("pixiImage")){i()}a.on("dragover",function(k){k.stopPropagation();k.preventDefault();var j=k.originalEvent.dataTransfer;j.dropEffect="copy";a.addClass("pixiOver")});a.on("dragleave",function(j){a.removeClass("pixiOver")});a.on("drop",function(l){l.stopPropagation();l.preventDefault();var k=l.originalEvent.dataTransfer;var m=k.files;a.removeClass("pixiOver");var j=new FileReader();j.readAsDataURL(m[0]);j.onload=function(){localStorage.setItem("pixiImage",this.result);i()}});if(a){var f=null;a.on("mousedown",function(l){var k=localStorage.getItem("pixiPos").split("px")[0]-l.pageX,j=localStorage.getItem("pixiPos").split("px")[1]-l.pageY;a.css("cursor","-webkit-grabbing");a.on("mousemove",function(m){if(f&&c){e=m.pageX+k,h=m.pageY+j;a.css("background-position",""+e+"px "+h+"px");localStorage.setItem("pixiPos",""+e+"px "+h+"px")}});f=$(l.target)}).on("mouseup",function(j){f=null;a.css("cursor","-webkit-grab")})}function i(){var j=localStorage.getItem("pixiImage");var l=localStorage.getItem("pixiPos");var k=localStorage.getItem("pixiOpacity")||1;a.css({"background-repeat":"no-repeat","background-image":"url("+j+")","background-position":l,opacity:k});a.addClass("hasItem")}$(document).keydown(function(n){var o=parseInt(a.css("background-position").split(" ")[0].replace("px",""));var j=parseInt(a.css("background-position").split(" ")[1].replace("px",""));var p=0;var m=n.keyCode||n.which,l={left:37,up:38,right:39,down:40,grid:71,zindex:90,shift:16,see:80,opacity:[48,49,50,51,52,53,54,55,56,57]};if(a.is(":visible")&&[16,37,38,39,40,48,49,50,51,52,53,54,55,56,57,71,80,90].indexOf(m)!=-1){n.stopPropagation();n.preventDefault()}switch(m){case l.left:o--;a.css("background-position",""+o+"px "+j+"px");break;case l.up:j--;a.css("background-position",""+o+"px "+j+"px");break;case l.right:o++;a.css("background-position",""+o+"px "+j+"px");break;case l.down:j++;a.css("background-position",""+o+"px "+j+"px");break;case l.grid:var k=document.activeElement;if(n.altKey||(k.tagName!="INPUT"||k.tagName!="TEXTAREA"||k.className!="fc_editable"||k.className!="im_editable")){a.toggleClass("pixiToggle")}break;case l.zindex:a.toggleClass("lowZindex");break;case l.shift:c=true;break;case l.see:a.toggleClass("pointerDisable");break;default:if(m>=48&&m<=57){$.each(l.opacity,function(q,r){if(l.opacity[q]===m){p=q/10||1;a.css("opacity",p);localStorage.setItem("pixiOpacity",p)}})}break}localStorage.setItem("pixiPos",""+o+"px "+j+"px")});$(document).keyup(function(k){var j=k.keyCode||k.which;if(j==16){c=false}})})})();